<!DOCTYPE html>


<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
    <title>DMI Combo</title>
    <script src="shr.js"></script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div id="pwd-area">
        <input id="password" type="password" placeholder="password" />
        <button onclick="checkPassword()">Check password</button>
    </div>
    <div id="nice-area" style="display: none;">
        <img id="imgWind" src="https://ocean.dmi.dk/anim/plots/win.ba.1.png" alt="vind">         
        <img id="imgWave" class="shrink-img" src="https://ocean.dmi.dk/anim/plots/hs.ba.1.png" alt="vind">
        <img id="imgDonn" class="shrink-img" src="https://ocean.dmi.dk/anim/plots/hsw.ba.1.png" alt="vind">
        
        <!-- Desktop slider -->
        <div class="slideRange desktop-slider">
            <button class="slider-btn" type="button" onclick="changeImageRel(-1)">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="slider-container">
                <input type="range" min="1" max="133" value="1" class="slider" id="myRange"
                    onchange="changeImage(this.value)" oninput="changeImage(this.value)">
                <div class="slider-info">
                    <span id="timeId"></span>
                    <button id="clearCache" type="button" onclick="clearCache()" title="Clear Cache (Force renewal of images, 66 Mb download)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 3V10H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div id="progressBar" class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
            </div>
            <button class="slider-btn" type="button" onclick="changeImageRel(+1)">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        
        <!-- Mobile slider 1 -->
        <div class="mobile-slider-item">
            <div class="slideRange mobile-slider">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(-1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <input type="range" min="1" max="133" value="1" class="slider mobile-range" 
                    onchange="changeImage(this.value)" oninput="changeImage(this.value)">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(+1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Mobile slider 2 -->
        <div class="mobile-slider-item">
            <div class="slideRange mobile-slider">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(-1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <input type="range" min="1" max="133" value="1" class="slider mobile-range" 
                    onchange="changeImage(this.value)" oninput="changeImage(this.value)">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(+1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Mobile slider 3 with info -->
        <div class="mobile-slider-item">
            <div class="slideRange mobile-slider">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(-1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <input type="range" min="1" max="133" value="1" class="slider mobile-range" 
                    onchange="changeImage(this.value)" oninput="changeImage(this.value)">
                <button class="slider-btn slider-btn-small" type="button" onclick="changeImageRel(+1)">
                    <svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="mobile-info">
                <span id="timeIdMobile"></span>
                <button id="clearCacheMobile" type="button" onclick="clearCache()" title="Clear Cache">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 3V10H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="progress-bar mobile-progress">
                <div class="progress-fill" id="progressFillMobile"></div>
            </div>
        </div>
        
        <div id="clearCachePos" style="display:none">
        </div>
    </div>
</body>

</html>

<script src="shr.js"></script>

<script>

    var str = ''
    var max = 133;
    let indexOutside = 0;
    const date = new Date();
    let utcHours = date.getUTCHours();
    let cacheDate = date.getUTCFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, "0") + '-' + (date.getUTCDate() + ((utcHours > 6) ? 0 : -1)).toString().padStart(2, "0") + 'T';
    console.log("utcHours", utcHours);
    if (utcHours > 18) {
        cacheDate += '12:00:00.000Z';
    } else if (utcHours > 12) {
        cacheDate += '06:00:00.000Z';
    } else if (utcHours > 6) {
        cacheDate += '00:00:00.000Z';
    } else
        cacheDate += '18:00:00.000Z';

    const lastCache = cacheDate;

    let forcedUpdate = undefined;

    console.log("lastCache", lastCache);
    let localStartDate = new Date(lastCache);
    console.log("lastCache localtime", localStartDate);

    isLoading = true;

    const weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    function changeImage(index) {
        console.log("change image", index);
        document.getElementById("imgWind").src = `https://ocean.dmi.dk/anim/plots/win.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        document.getElementById("imgWave").src = `https://ocean.dmi.dk/anim/plots/hs.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        document.getElementById("imgDonn").src = `https://ocean.dmi.dk/anim/plots/hsw.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        indexOutside = parseInt(index);
        const currentDate = new Date(new Date(localStartDate).getTime() + ((index-1) * 3600 * 1000));
        console.log("currentDate", currentDate, localStartDate, new Date(localStartDate).getTime(), (index * 3600 * 1000));
        
        const timeText = currentDate.toLocaleString() + " - " + weekday[currentDate.getDay()];
        document.getElementById("timeId").innerHTML = timeText;
        const timeIdMobile = document.getElementById("timeIdMobile");
        if (timeIdMobile) {
            timeIdMobile.innerHTML = timeText;
        }
        
        // Sync all sliders
        document.getElementById('myRange').value = index;
        document.querySelectorAll('.mobile-range').forEach(slider => {
            slider.value = index;
        });
    }

    function changeImageRel(rel) {
        rel = parseInt(rel);
        console.log("change image rel", rel, indexOutside);
        indexOutside += rel;
        console.log("change image rel", indexOutside);
        if (indexOutside > max) {
            indexOutside = max;
        }
        if (indexOutside < 1) {
            indexOutside = 1;
        }
        changeImage(indexOutside);
        document.getElementById('myRange').value = indexOutside;
    }


    function changeImageClick(index) {
        console.log("change image click", index);
        changeImage(index);
    }

    function clearCache() {
        console.log("clear cache");        
        preLoadImages(true);
    }

    function checkPassword(pwd) {
        const password = pwd ? pwd : document.getElementById("password").value;
        if (cyrb53(password) === 8752902336368466) {
            localStorage.setItem("password", password);
            document.getElementById("pwd-area").style.display = "none";
            document.getElementById("nice-area").style = undefined;
        }
    }

    const cyrb53 = (str, seed = 0) => {
        let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
        for (let i = 0, ch; i < str.length; i++) {
            ch = str.charCodeAt(i);
            h1 = Math.imul(h1 ^ ch, 2654435761);
            h2 = Math.imul(h2 ^ ch, 1597334677);
        }
        h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507);
        h1 ^= Math.imul(h2 ^ (h2 >>> 13), 3266489909);
        h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507);
        h2 ^= Math.imul(h1 ^ (h1 >>> 13), 3266489909);

        return 4294967296 * (2097151 & h2) + (h1 >>> 0);
    };

    const savedPwd = localStorage.getItem("password", password);
    checkPassword(savedPwd);


    //Preload images

    function updateProgress(loaded, total) {
        const progressBar = document.getElementById("progressBar");
        const progressFill = document.getElementById("progressFill");
        const progressFillMobile = document.getElementById("progressFillMobile");
        
        const percent = (loaded / total) * 100;
        
        if (progressFill) {
            progressFill.style.width = percent + '%';
        }
        if (progressFillMobile) {
            progressFillMobile.style.width = percent + '%';
        }
        
        if (progressBar) {
            if (loaded >= total) {
                setTimeout(() => {
                    progressBar.style.opacity = '0';
                    const mobileProgress = document.querySelector('.mobile-progress');
                    if (mobileProgress) mobileProgress.style.opacity = '0';
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        if (mobileProgress) mobileProgress.style.display = 'none';
                    }, 300);
                }, 500);
            } else {
                progressBar.style.display = 'block';
                progressBar.style.opacity = '1';
                const mobileProgress = document.querySelector('.mobile-progress');
                if (mobileProgress) {
                    mobileProgress.style.display = 'block';
                    mobileProgress.style.opacity = '1';
                }
            }
        }
    }

    function preLoadImages(force) {
        forcedUpdate = force ? Math.random() : undefined;
        const clearCacheBtn = document.getElementById("clearCache");
        const clearCacheMobile = document.getElementById("clearCacheMobile");
        
        if (clearCacheBtn) {
            clearCacheBtn.disabled = true;
            clearCacheBtn.style.opacity = '0.5';
        }
        if (clearCacheMobile) {
            clearCacheMobile.disabled = true;
            clearCacheMobile.style.opacity = '0.5';
        }
        
        isLoading = true;
        list = [];
        maxIndex = 134;
        let loadCount = 0;
        const totalImages = (maxIndex - 1) * 3;
        
        // Show initial progress
        updateProgress(0, totalImages);
        
        for (var i = 1; i < maxIndex; i++) {
            var img1 = new Image();
            var img2 = new Image();
            var img3 = new Image();
            
            const onImageLoad = function () {
                var index = list.indexOf(this);
                loadCount++;
                updateProgress(loadCount, totalImages);
                
                if (index !== -1) {
                    list.splice(index, 1);
                }

                if (loadCount === totalImages) {
                    console.log("loaded all");
                    if (clearCacheBtn) {
                        clearCacheBtn.disabled = false;
                        clearCacheBtn.style.opacity = '1';
                    }
                    if (clearCacheMobile) {
                        clearCacheMobile.disabled = false;
                        clearCacheMobile.style.opacity = '1';
                    }
                    isLoading = false;
                }
            };
            
            img1.onload = onImageLoad;
            img2.onload = onImageLoad;
            img3.onload = onImageLoad;

            list.push(img1);
            list.push(img2);
            list.push(img3);

            img1.src = `https://ocean.dmi.dk/anim/plots/win.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
            img2.src = `https://ocean.dmi.dk/anim/plots/hs.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
            img3.src = `https://ocean.dmi.dk/anim/plots/hsw.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
        }
    }

    changeImage(1);

    // Start preloading in background after a short delay
    setTimeout(() => {
        preLoadImages();
    }, 500);



</script>

<style>
    html,
    body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        background: #1a1a1a;
    }
    
    #nice-area {
        width: 100%;
        min-height: 100vh;
        height: 100vh;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 6px;
        padding: 6px;
        padding-bottom: 90px;
        box-sizing: border-box;
        background: #1a1a1a;
        overflow: hidden;
        position: relative;
    }

    p {
        font-size: 6px;
        margin: 0;
        padding: 0;
    }

    img {
        width: 100%;
        height: 100%;
        max-height: 100%;
        object-fit: contain;
        border: none;
        border-radius: 8px;
        position: relative;
        box-sizing: border-box;
        display: block;
        background: #2a2a2a;
    }

    #imgWind {
        grid-column: 1;
        grid-row: 1;
        min-height: 0;
    }

    #imgWave {
        grid-column: 2;
        grid-row: 1;
        min-height: 0;
    }

    #imgDonn {
        grid-column: 1 / -1;
        grid-row: 2;
        min-height: 0;
    }

    #clearCachePos {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        color: #333;
        z-index: 1001;
        font-size: 18px;
        font-weight: 600;
    }
    
    #clearCachePos span {
        color: #0081c5;
        font-weight: 600;
    }
    
    #clearCache {
        padding: 4px;
        background: transparent;
        color: #888;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s ease;
        margin-left: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
    }
    
    #clearCache:disabled {
        cursor: not-allowed;
        opacity: 0.5;
    }
    
    #clearCache svg {
        transition: transform 0.3s ease;
    }
    
    #clearCache:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #aaa;
    }
    
    #clearCache:hover svg {
        transform: rotate(180deg);
    }



    /* On screens that are 992px or less, set the background color to blue */
    @media screen and (max-width: 992px) {
        #nice-area {
            display: flex;
            flex-direction: column;
            padding: 10px;
            padding-bottom: 20px;
            height: auto;
            min-height: 100vh;
            overflow: visible;
            gap: 10px;
        }
        
        .desktop-slider {
            display: none !important;
        }
        
        .mobile-slider-item {
            display: flex !important; /* override later desktop rule */
            width: 100%;
            padding: 0;
            box-sizing: border-box;
        }
        
        .mobile-slider {
            display: flex !important;
            width: 100%;
        }
        
        .mobile-info {
            display: flex !important; /* override later desktop rule */
        }
        
        .mobile-range {
            flex: 1;
            min-width: 100px;
        }
        
        img {
            min-height: 0;
            height: auto;
            width: 100%;
            aspect-ratio: 16 / 9;
        }
        
        #imgWind {
            order: 1;
        }
        
        .mobile-slider-item:nth-child(5) {
            order: 2;
        }

        #imgWave {
            order: 3;
        }
        
        .mobile-slider-item:nth-child(6) {
            order: 4;
        }

        #imgDonn {
            order: 5;
        }
        
        .mobile-slider-item:nth-child(7) {
            order: 6;
        }
    }

    #slideContainer {
        display: none;
    }

    .slideRange {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        bottom: 0;
        bottom: env(safe-area-inset-bottom, 0);
        left: 0;
        right: 0;
        width: 100%;
        max-width: 100vw;
        padding: 12px 16px;
        padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));
        background: rgba(42, 42, 42, 0.98);
        border-radius: 0;
        box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 9999;
        gap: 12px;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
        box-sizing: border-box;
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        will-change: transform;
    }
    
    .desktop-slider {
        display: flex;
    }
    
    .mobile-slider {
        display: none;
        position: relative;
        bottom: auto;
        padding: 8px 10px;
        margin: 0;
        background: rgba(42, 42, 42, 0.95);
        border-radius: 8px;
        gap: 8px;
    }
    
    .slider-btn-small {
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
    
    .mobile-info {
        display: none;
        align-items: center;
        justify-content: space-between;
        padding: 6px 10px;
        background: rgba(42, 42, 42, 0.95);
        border-radius: 8px;
        margin-top: 6px;
        font-size: 10px;
        color: #aaa;
    }
    
    .mobile-info span {
        flex: 1;
        text-align: center;
    }
    
    .mobile-info button {
        padding: 4px;
        background: transparent;
        color: #888;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .mobile-info button:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .mobile-info button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .mobile-slider-item {
        display: none;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 10px;
    }
    
    .mobile-progress {
        height: 2px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    @media screen and (max-width: 600px) {
        .slideRange {
            padding: 10px 12px;
        }
    }

    * {
        -ms-touch-action: manipulation;
        touch-action: manipulation;
    }
    
    .slider-btn {
        background: #3a3a3a;
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        width: 44px;
        height: 44px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
        padding: 0;
    }
    
    .slider-btn svg {
        transition: transform 0.2s ease;
    }
    
    .slider-btn:hover {
        background: #4a4a4a;
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    
    .slider-btn:hover svg {
        transform: scale(1.1);
    }
    
    .slider-btn:active {
        transform: scale(0.95);
        background: #2a2a2a;
    }
    
    .slider {
        flex: 1;
        min-width: 150px;
        width: 100%;
        touch-action: pan-x;
    }
    
    .slider-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
        position: relative;
    }
    
    .progress-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 1px;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.3s ease;
        display: none;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4a9eff, #7b61ff);
        border-radius: 1px;
        transition: width 0.3s ease;
        width: 0%;
    }
    
    .slider-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 11px;
        color: #aaaaaa;
        padding: 0 4px;
        gap: 8px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }
    
    .slider-info span {
        flex: 1;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    @media screen and (max-width: 768px) {
        .slider-info {
            font-size: 9px;
        }
        
        #clearCache {
            font-size: 12px;
        }
    }
    
    input[type=range]::-webkit-slider-thumb {
        cursor: pointer;
    }
    
    input[type=range]::-moz-range-thumb {
        cursor: pointer;
    }
    
    input[type=range]::-ms-thumb {
        cursor: pointer;
    }
</style>