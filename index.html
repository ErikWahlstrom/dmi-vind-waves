<!DOCTYPE html>


<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
    <title>DMI Combo</title>
    <script src="shr.js"></script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div id="pwd-area">
        <input id="password" type="password" placeholder="password" />
        <button onclick="checkPassword()">Check password</button>
    </div>
    <div id="nice-area" style="display: none;">
        <img id="imgWind" src="https://ocean.dmi.dk/anim/plots/win.ba.1.png" alt="vind">
        <img id="imgWave" class="shrink-img" src="https://ocean.dmi.dk/anim/plots/hs.ba.1.png" alt="vind">
        <img id="imgDonn" class="shrink-img" src="https://ocean.dmi.dk/anim/plots/hsw.ba.1.png" alt="vind">
        <!-- <div class="table-class" id="slideContainer"></div> -->
        <div class="slideRange">
            <button class="slider-btn" type="button" onclick="changeImageRel(-1)">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="slider-container">
                <input type="range" min="1" max="133" value="1" class="slider" id="myRange"
                    onchange="changeImage(this.value)" oninput="changeImage(this.value)">
                <div class="slider-info">
                    <span id="timeId"></span>
                    <button id="clearCache" type="button" onclick="clearCache()" title="Clear Cache (Force renewal of images, 66 Mb download)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 3V10H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
            <button class="slider-btn" type="button" onclick="changeImageRel(+1)">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.5 2L8.5 6L4.5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div id="clearCachePos" style="display:none">
            <span id="pre-load">Loading...</span>
        </div>
    </div>
</body>

</html>

<script src="shr.js"></script>

<script>

    var str = ''
    var max = 133;
    let indexOutside = 0;
    const date = new Date();
    let utcHours = date.getUTCHours();
    let cacheDate = date.getUTCFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, "0") + '-' + (date.getUTCDate() + ((utcHours > 6) ? 0 : -1)).toString().padStart(2, "0") + 'T';
    console.log("utcHours", utcHours);
    if (utcHours > 18) {
        cacheDate += '12:00:00.000Z';
    } else if (utcHours > 12) {
        cacheDate += '06:00:00.000Z';
    } else if (utcHours > 6) {
        cacheDate += '00:00:00.000Z';
    } else
        cacheDate += '18:00:00.000Z';

    const lastCache = cacheDate;

    let forcedUpdate = undefined;

    console.log("lastCache", lastCache);
    let localStartDate = new Date(lastCache);
    console.log("lastCache localtime", localStartDate);

    isLoading = true;

    const weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    function changeImage(index) {
        console.log("change image", index);
        document.getElementById("imgWind").src = `https://ocean.dmi.dk/anim/plots/win.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        document.getElementById("imgWave").src = `https://ocean.dmi.dk/anim/plots/hs.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        document.getElementById("imgDonn").src = `https://ocean.dmi.dk/anim/plots/hsw.ba.${index}.png?cache=${lastCache+(forcedUpdate??"")}`
        indexOutside = parseInt(index);
        const currentDate = new Date(new Date(localStartDate).getTime() + ((index-1) * 3600 * 1000));
        console.log("currentDate", currentDate, localStartDate, new Date(localStartDate).getTime(), (index * 3600 * 1000));
        
        document.getElementById("timeId").innerHTML = currentDate.toLocaleString() + " - " + weekday[currentDate.getDay()];
    }

    function changeImageRel(rel) {
        rel = parseInt(rel);
        console.log("change image rel", rel, indexOutside);
        indexOutside += rel;
        console.log("change image rel", indexOutside);
        if (indexOutside > max) {
            indexOutside = max;
        }
        if (indexOutside < 1) {
            indexOutside = 1;
        }
        changeImage(indexOutside);
        document.getElementById('myRange').value = indexOutside;
    }


    function changeImageClick(index) {
        console.log("change image click", index);
        changeImage(index);
    }

    function clearCache() {
        console.log("clear cache");        
        preLoadImages(true);
    }

    function checkPassword(pwd) {
        const password = pwd ? pwd : document.getElementById("password").value;
        if (cyrb53(password) === 8752902336368466) {
            localStorage.setItem("password", password);
            document.getElementById("pwd-area").style.display = "none";
            document.getElementById("nice-area").style = undefined;
        }
    }

    const cyrb53 = (str, seed = 0) => {
        let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
        for (let i = 0, ch; i < str.length; i++) {
            ch = str.charCodeAt(i);
            h1 = Math.imul(h1 ^ ch, 2654435761);
            h2 = Math.imul(h2 ^ ch, 1597334677);
        }
        h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507);
        h1 ^= Math.imul(h2 ^ (h2 >>> 13), 3266489909);
        h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507);
        h2 ^= Math.imul(h1 ^ (h1 >>> 13), 3266489909);

        return 4294967296 * (2097151 & h2) + (h1 >>> 0);
    };

    const savedPwd = localStorage.getItem("password", password);
    checkPassword(savedPwd);


    //Preload images

    function preLoadImages(force) {
        forcedUpdate = force ? Math.random() : undefined;
        document.getElementById("clearCache").style.display = "none";
        document.getElementById("pre-load").style = undefined;
        isLoading = true;
        list = [];
        maxIndex = 134
        let loadCount = 0;
        for (var i = 1; i < maxIndex; i++) {
            var img1 = new Image();
            var img2 = new Image();
            var img3 = new Image();
            img1.onload = function () {
                var index = list.indexOf(this);
                if (index !== -1) {
                    // remove image from the array once it's loaded
                    // for memory consumption reasons
                    list.splice(index, 1);
                }
            }

            img2.onload = function () {
                var index = list.indexOf(this);
                if (index !== -1) {
                    // remove image from the array once it's loaded
                    // for memory consumption reasons
                    list.splice(index, 1);
                }
            }


            img3.onload = function () {
                var index = list.indexOf(this);
                loadCount++;
                if (index !== -1) {
                    // remove image from the array once it's loaded
                    // for memory consumption reasons                    
                    list.splice(index, 1);
                }

                if (loadCount === maxIndex - 1) {
                    console.log("loaded all");
                    document.getElementById("clearCache").style = undefined;
                    document.getElementById("pre-load").style.display = "none";
                    isLoading = false;
                }
            }

            list.push(img1);
            list.push(img2);
            list.push(img3);

            img1.src = `https://ocean.dmi.dk/anim/plots/win.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
            img2.src = `https://ocean.dmi.dk/anim/plots/hs.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
            img3.src = `https://ocean.dmi.dk/anim/plots/hsw.ba.${i}.png?cache=${lastCache+(forcedUpdate??"")}`
        }
    }

    changeImage(1);

    preLoadImages();

    // Handle zoom on mobile - keep slider visible and positioned correctly
    let lastScale = 1;
    
    function updateSliderPosition() {
        const slider = document.querySelector('.slideRange');
        if (!slider) return;
        
        const scale = window.visualViewport ? window.visualViewport.scale : 1;
        const isZoomed = scale > 1.1;
        
        if (isZoomed) {
            // When zoomed, make slider stick to visual viewport
            slider.style.position = 'fixed';
            slider.style.bottom = '0px';
            slider.style.left = '0';
            slider.style.right = '0';
            slider.style.width = '100%';
        } else {
            // When not zoomed, keep normal positioning
            slider.style.position = 'fixed';
            slider.style.bottom = '0';
            slider.style.left = '0';
            slider.style.right = '0';
            slider.style.width = '100%';
        }
        
        lastScale = scale;
    }
    
    // Listen for zoom changes on mobile
    if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', updateSliderPosition);
        window.visualViewport.addEventListener('scroll', updateSliderPosition);
    }
    
    // Fallback for older browsers
    window.addEventListener('resize', updateSliderPosition);
    window.addEventListener('scroll', updateSliderPosition);
    
    // Initial positioning
    setTimeout(updateSliderPosition, 100);



</script>

<style>
    html,
    body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        background: #1a1a1a;
    }
    
    #nice-area {
        width: 100%;
        min-height: 100vh;
        height: 100vh;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 6px;
        padding: 6px;
        padding-bottom: 90px;
        box-sizing: border-box;
        background: #1a1a1a;
        overflow: hidden;
    }

    p {
        font-size: 6px;
        margin: 0;
        padding: 0;
    }

    img {
        width: 100%;
        height: 100%;
        max-height: 100%;
        object-fit: contain;
        border: none;
        border-radius: 8px;
        position: relative;
        box-sizing: border-box;
        display: block;
        background: #2a2a2a;
    }

    #imgWind {
        grid-column: 1;
        grid-row: 1;
        min-height: 0;
    }

    #imgWave {
        grid-column: 2;
        grid-row: 1;
        min-height: 0;
    }

    #imgDonn {
        grid-column: 1 / -1;
        grid-row: 2;
        min-height: 0;
    }

    #clearCachePos {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        color: #333;
        z-index: 1001;
        font-size: 18px;
        font-weight: 600;
    }
    
    #clearCachePos span {
        color: #0081c5;
        font-weight: 600;
    }
    
    #clearCache {
        padding: 4px;
        background: transparent;
        color: #888;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s ease;
        margin-left: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 0;
    }
    
    #clearCache svg {
        transition: transform 0.3s ease;
    }
    
    #clearCache:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #aaa;
    }
    
    #clearCache:hover svg {
        transform: rotate(180deg);
    }



    /* On screens that are 992px or less, set the background color to blue */
    @media screen and (max-width: 992px) {
        #nice-area {
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            padding-bottom: 100px;
            height: auto;
            min-height: 100vh;
            overflow: visible;
        }
        
        img {
            min-height: 0;
            height: auto;
            aspect-ratio: 16 / 9;
        }
        
        #imgWind {
            grid-column: 1;
            grid-row: 1;
        }

        #imgWave {
            grid-column: 1;
            grid-row: 2;
        }

        #imgDonn {
            grid-column: 1;
            grid-row: 3;
        }
    }

    #slideContainer {
        display: none;
    }

    .slideRange {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-width: 100vw;
        padding: 12px 16px;
        background: rgba(42, 42, 42, 0.98);
        border-radius: 0;
        box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 9999;
        gap: 12px;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
        box-sizing: border-box;
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        will-change: transform;
    }
    
    @media screen and (max-width: 600px) {
        .slideRange {
            padding: 10px 12px;
        }
    }

    * {
        -ms-touch-action: manipulation;
        touch-action: manipulation;
    }
    
    .slider-btn {
        background: #3a3a3a;
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        width: 44px;
        height: 44px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
        padding: 0;
    }
    
    .slider-btn svg {
        transition: transform 0.2s ease;
    }
    
    .slider-btn:hover {
        background: #4a4a4a;
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    
    .slider-btn:hover svg {
        transform: scale(1.1);
    }
    
    .slider-btn:active {
        transform: scale(0.95);
        background: #2a2a2a;
    }
    
    .slider {
        flex: 1;
        min-width: 150px;
        width: 100%;
        touch-action: pan-x;
    }
    
    .slider-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
    }
    
    .slider-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 11px;
        color: #aaaaaa;
        padding: 0 4px;
        gap: 8px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }
    
    .slider-info span {
        flex: 1;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    @media screen and (max-width: 768px) {
        .slider-info {
            font-size: 9px;
        }
        
        #clearCache {
            font-size: 12px;
        }
    }
    
    input[type=range]::-webkit-slider-thumb {
        cursor: pointer;
    }
    
    input[type=range]::-moz-range-thumb {
        cursor: pointer;
    }
    
    input[type=range]::-ms-thumb {
        cursor: pointer;
    }
</style>